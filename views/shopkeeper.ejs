<!DOCTYPE html>
<html>
<head>
    <title>ShopMyStationary</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Josefin+Sans:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{
            font-family: 'Josefin Sans', sans-serif;
    margin: 0;
    padding: 0;
    box-sizing: border-box ;
}
.navbar {
    background-color: #c92828;
    color: #fff;
    display: flex;
    justify-content: space-between;
    height: 55px;
    padding: 1rem 6.5rem;
    background-color: #4c4c4e;
}
table {
    border-collapse: collapse;
    width: 80%;
    margin: 20px auto;
}
table, th, td {
    border: 1px solid black;
}
th, td {
    padding: 10px;
    text-align: left;
}
th {
    background-color: #333;
    color: white;
}
.status-button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
}
html {
    height:100%;
  }
  
  body {
    margin:0;
  }
  
  .bg {
    animation:slide 3s ease-in-out infinite alternate;
    background-image: linear-gradient(-60deg, #ff5733 50%, #E9E6DD 50%);
    bottom:0;
    left:-50%;
    opacity:.5;
    position:fixed;
    right:-50%;
    top:0;
    z-index:-1;
  }
  
  .bg2 {
    animation-direction:alternate-reverse;
    animation-duration:4s;
  }
  
  .bg3 {
    animation-duration:5s;
  }
  
  .content {
    background-color:rgba(255,255,255,.8);
    border-radius:.25em;
    box-shadow:0 0 .25em rgba(0,0,0,.25);
    box-sizing:border-box;
    left:50%;
    padding:10vmin;
    position:fixed;
    text-align:center;
    top:50%;
    transform:translate(-50%, -50%);
  }
  @keyframes slide {
    0% {
      transform:translateX(-25%);
    }
    100% {
      transform:translateX(25%);
    }
  }
    </style>
</head>
<body>
    <div class="navbar">
        <h1 style="position: absolute;left: 42%;">BookMyStationary</h1>
    </div>
    <div class="bg"></div>
<div class="bg bg2"></div>
<div class="bg bg3"></div>
    <table>
        <tr>
            <th>Email</th>
            <th>Filename</th>
            <th>Cost</th>
            <th>Date</th>
            <th>Status</th>
        </tr>
        <% if(items) { %>
            <% items.forEach(item => { %>
                <tr>
                    <th><%= item.emailid %></th>
                    <th class="pdf-link" data-pdf="<%= item.pdf_path %>"><%= item.pdf_path %></th>
                    <th><%= item.cost %></th>
                    <th><%= item.date %></th>
                    <th><button class="status-button" id="statusbutton" onclick="updateOrderStatus(this, 'Completed')"><%= item.status %></button></th>
                </tr>
            <% }); %> 
        <% } %>    

        <iframe id="pdfViewer" width="100%" height="500" src="" style="display: none;"></iframe>
        <script>
            function updateOrderStatus(button, newStatus) {
                // Extract data from the row
                const row = button.parentNode.parentNode;
                const emailId = row.cells[0].textContent;
                const pdfName = row.cells[1].textContent;
                
                // Send a POST request to the server
                fetch('/shopkeep', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        emailId: emailId,
                        pdfName: pdfName,
                        newStatus: newStatus
                    })
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Failed to update order status');
                    }
                })
                .catch(error => {
                    console.error(error);
                });
            }
            const pdfLinkElements = document.querySelectorAll('.pdf-link');
            const pdfViewer = document.getElementById('pdfViewer');

            pdfLinkElements.forEach(link => {
                link.addEventListener('click', () => {
                    const pdfPath = "uploads/" + link.getAttribute('data-pdf');
                    console.log(pdfPath);
                    pdfViewer.src = pdfPath;
                    pdfViewer.style.display = 'block';
            });
        });
        </script>
</body>
</html>
